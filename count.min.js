!(function(){console.info("welcome to use analytics_with_cloudflare url: https://github.com/yestool/analytics_with_cloudflare");const scriptElement=document.currentScript;let baseUrl=scriptElement.getAttribute("data-base-url"),pagePvId=scriptElement.getAttribute("data-page-pv-id"),pageUvId=scriptElement.getAttribute("data-page-uv-id");const WebViso={version:"0.0.0"};let apiBaseUrl="https://count.kafuchino.top";WebViso.page_pv_id="cf_page_pv",WebViso.page_uv_id="cf_page_uv",baseUrl&&(apiBaseUrl=baseUrl),pagePvId&&(WebViso.page_pv_id=pagePvId),pageUvId&&(WebViso.page_uv_id=pageUvId),WebViso.init=async function(){const locationInfo=getLocation(window.location.href),pvElement=document.getElementById(WebViso.page_pv_id),uvElement=document.getElementById(WebViso.page_uv_id),visitData={url:locationInfo.pathname,hostname:locationInfo.hostname,referrer:document.referrer};pvElement&&(visitData.pv=!0),uvElement&&(visitData.uv=!0),await fetch(`${apiBaseUrl}/api/visit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(visitData)}).then(response=>response.json()).then(data=>{if("OK"!==data.ret)return void console.error("WebViso.init error",data.message);const resultData=data.data;pvElement&&(pvElement.innerText=resultData.pv),uvElement&&(uvElement.innerText=resultData.uv)}).catch(error=>{console.log("WebViso.init fetch error",error)})};const getLocation=function(url){const linkElement=document.createElement("a");return linkElement.href=url,linkElement};"undefined"!=typeof window&&(WebViso.init(),window.WebViso=WebViso)})();
